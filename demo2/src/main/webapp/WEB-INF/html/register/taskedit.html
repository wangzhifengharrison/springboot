<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
</head>
<body>
	<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
		<form class="form-horizontal" onsubmit="return false" id="form">
			<fieldset>
				<input type="hidden" id="id" name="id">

				<div class="form-group">
					<label class="col-md-2 control-label">Task name</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="Task name" type="text"
							name="name" id="taskname" data-bv-notempty="true"
							data-bv-notempty-message="Task name not null">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">Project code</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="Project code" type="text"
							name="name" id="projectcode" data-bv-notempty="true"
							data-bv-notempty-message="Project code not null">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">Task description</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="Task description"
							type="text" name="name" id="taskdescription"
							data-bv-notempty="true"
							data-bv-notempty-message="Task description not null">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">Task due date</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="Task due date"
							type="date" name="name" id="taskduedate" data-bv-notempty="true"
							data-bv-notempty-message="Task due date not null">
					</div>
				</div>

				<div class="form-group">
					<label class="col-md-2 control-label">Task create date</label>
					<div class="col-md-10">
						<input class="form-control" placeholder="Task create date"
							type="date" name="name" id="taskcreatedate"
							data-bv-notempty="true"
							data-bv-notempty-message="Task create date not null">
					</div>
				</div>

				<div class="form-actions">
					<div class="row" align="center">
						<div class="col-md-12">
							<button class="btn btn-primary" onclick="windowclose()">Cancel</button>
							<button class="btn btn-primary" type="submit" onclick="update()">
								<i class="fa fa-save"></i> Submit
							</button>
						</div>
					</div>
				</div>
				<div id ="info"></div>

			</fieldset>
		</form>
	</div>
	<!-- jquery -->
	<script
		src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script type="text/javascript">
		initData();
		/* Inital data in the task table */
		function initData() {
			var id = window.opener.document.getElementById("dt-table").value;
			if (id != "") {
				$.ajax({
					type : 'get',
					url : '/demo2/superadmin/gettaskbyid?taskId=' + id,
					async : false,
					success : function(data) {
						/* alert(data.login.loginName); */
						$("#taskname").val(data.task.taskName);
						$("#projectcode").val(data.task.projectCode);
						$("#taskdescription").val(data.task.taskDescription);
						$("#taskduedate").val(data.task.taskDuedate);
						$("#taskcreatedate").val(data.task.taskCreatedate);
					}
				});

			}
		}
		/* cancel button in taskedit */
		function windowclose() {
			window.opener = null;
			window.open('', '_self');
			window.close();
		}
		/* edit data in task table */
		function update() {
			/* form a json object */
			var id = window.opener.document.getElementById("dt-table").value;
			var formData = {
				taskId : id,
				taskName : $("#taskname").val(),
				projectCode : $("#projectcode").val(),
				taskDescription : $("#taskdescription").val(),
				taskDuedate : $("#taskduedate").val(),
				taskCreatedate : $("#taskcreatedate").val()	
			}
			/* post data to database */
			$.ajax({
				type : 'post',
				data : JSON.stringify(formData),
				contentType : "application/json",
				dataType : 'json',
				async : false,
				url : '/demo2/superadmin/modifytask',
				success : function(data) {
					/* modify success */
					alert("success to save");
					window.close();
					/* update data in index.html */
					window.opener.location.reload();
				},
				error : function(xhr, textStatus, errorThrown) {
					var msg = xhr.responseText;
					var response = JSON.parse(msg);
					$("#info").html(response.message);
					$(obj).attr("disabled", false);
				}
			});
		}
	</script>
</body>
</html>